{% article i18n="zh-CN" %}

# æ•°æ®ç»“æ„

## Know about Array

æ•°ç»„æ˜¯æ—¥å¸¸æ•²ä»£ç ä½¿ç”¨ç›¸å½“é¢‘ç¹çš„ç±»å‹ä¹‹ä¸€ï¼Œåœ¨ zig ä¸­ï¼Œæ•°ç»„çš„åˆ†é…å’Œ C ç±»ä¼¼ï¼Œå‡æ˜¯åœ¨å†…å­˜ä¸­è¿ç»­åˆ†é…ä¸”å›ºå®šæ•°é‡çš„ç›¸åŒç±»å‹å…ƒç´ ã€‚

å› æ­¤æ•°ç»„æœ‰ä»¥ä¸‹ä¸‰ç‚¹ç‰¹æ€§ï¼š

- é•¿åº¦å›ºå®š
- å…ƒç´ å¿…é¡»æœ‰ç›¸åŒçš„ç±»å‹
- ä¾æ¬¡çº¿æ€§æ’åˆ—

åœ¨ zig ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„æ–¹æ³•ï¼Œæ¥å£°æ˜å¹¶å®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼š

```zig
const print = @import("std").debug.print;

pub fn main() void {
    const message = [5]u8{ 'h', 'e', 'l', 'l', 'o' };
    // const message = [_]u8{ 'h', 'e', 'l', 'l', 'o' };
    print("{s}\n", .{message}); // hello
    print("{c}\n", .{message[0]}); // h
}
```

ä»¥ä¸Šä»£ç å±•ç¤ºäº†å®šä¹‰ä¸€ä¸ªå­—é¢é‡æ•°ç»„çš„æ–¹å¼ï¼Œå…¶ä¸­ä½ å¯ä»¥é€‰æ‹©æŒ‡æ˜æ•°ç»„çš„å¤§å°æˆ–è€…ä½¿ç”¨ `_` ä»£æ›¿ã€‚ä½¿ç”¨ `_` æ—¶ï¼Œzig ä¼šå°è¯•è‡ªåŠ¨è®¡ç®—æ•°ç»„çš„é•¿åº¦ã€‚

æ•°ç»„å…ƒç´ æ˜¯è¿ç»­æ”¾ç½®çš„ï¼Œæ•…æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹æ ‡æ¥è®¿é—®æ•°ç»„çš„å…ƒç´ ï¼Œä¸‹æ ‡ç´¢å¼•ä» `0` å¼€å§‹ï¼

å…³äº[è¶Šç•Œé—®é¢˜](https://ziglang.org/documentation/master/#Index-out-of-Bounds)ï¼Œzig åœ¨ç¼–è¯‘æœŸå’Œè¿è¡Œæ—¶å‡æœ‰å®Œæ•´çš„è¶Šç•Œä¿æŠ¤å’Œå®Œå–„çš„å †æ ˆé”™è¯¯è·Ÿè¸ªã€‚

### Multidimensional Arrays

å¤šç»´æ•°ç»„ï¼ˆçŸ©é˜µï¼‰å®é™…ä¸Šå°±æ˜¯åµŒå¥—æ•°ç»„ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªå¤šç»´æ•°ç»„å‡ºæ¥ï¼š

```zig
const print = @import("std").debug.print;

pub fn main() void {
    const matrix_4x4 = [4][4]f32{
        [_]f32{ 1.0, 0.0, 0.0, 0.0 },
        [_]f32{ 0.0, 1.0, 0.0, 1.0 },
        [_]f32{ 0.0, 0.0, 1.0, 0.0 },
        [_]f32{ 0.0, 0.0, 0.0, 1.0 },
    };

    for (matrix_4x4, 0..) |arr_val, arr_index| {
        for (arr_val, 0..) |val, index| {
            print("å…ƒç´ {}-{}æ˜¯: {}\n", .{ arr_index, index, val });
        }
    }
}
```

åœ¨ä»¥ä¸Šçš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† `for` å¾ªç¯ï¼Œæ¥è¿›è¡ŒçŸ©é˜µçš„æ‰“å°ã€‚

### Sentinel-Terminated Arrays

æˆ‘ä»¬ä½¿ç”¨è¯­æ³• `[N:x]T` æ¥æè¿°ä¸€ä¸ªå…ƒç´ ä¸ºç±»å‹ `T`ï¼Œé•¿åº¦ä¸º `N` çš„æ•°ç»„ï¼Œåœ¨å®ƒå¯¹åº” `N` çš„ç´¢å¼•å¤„çš„å€¼åº”è¯¥æ˜¯ `x`ã€‚å°±æ˜¯è¿™ä¸ªè¯­æ³•è¡¨ç¤ºæ•°ç»„çš„é•¿åº¦ç´¢å¼•å¤„çš„å…ƒç´ åº”è¯¥æ˜¯ `x`ï¼Œå…·ä½“å¯ä»¥çœ‹ä¸‹é¢çš„ç¤ºä¾‹ï¼š

```zig
const print = @import("std").debug.print;

pub fn main() void {
    const array = [_:0]u8{ 1, 2, 3, 4 };
    print("æ•°ç»„é•¿åº¦ä¸º: {}\n", .{array.len}); // 4
    print("æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ å€¼: {}\n", .{array[array.len - 1]}); // 4
    print("å“¨å…µå€¼ä¸º: {}\n", .{array[array.len]}); // 0
}
```

{% callout type="note" title="æç¤º" %}

åªæœ‰åœ¨ä½¿ç”¨ Sentinel Termination æ—¶ï¼Œæ•°ç»„æ‰ä¼šæœ‰ç´¢å¼•ä¸ºæ•°ç»„é•¿åº¦çš„å…ƒç´ ï¼

{% /callout %}

### Operation

#### Multiplication

å¯ä»¥ä½¿ç”¨ `**` å¯¹æ•°ç»„åšä¹˜æ³•æ“ä½œï¼Œè¿ç®—ç¬¦å·¦ä¾§æ˜¯æ•°ç»„ï¼Œå³ä¾§æ˜¯å€æ•°ï¼Œè¿›è¡ŒçŸ©é˜µçš„å åŠ ã€‚

```zig
const print = @import("std").debug.print;

pub fn main() void {
    const small = [3]i8{ 1, 2, 3 };
    const big: [9]i8 = small ** 3;
    print("{any}\n", .{big}); // [9]i8{ 1, 2, 3, 1, 2, 3, 1, 2, 3 }
}
```

#### Series

æ•°ç»„ä¹‹é—´å¯ä»¥ä½¿ç”¨ `++` è¿›è¡Œä¸²è”æ“ä½œï¼ˆç¼–è¯‘æœŸï¼‰ï¼Œåªè¦ä¸¤ä¸ªæ•°ç»„ç±»å‹ï¼ˆé•¿åº¦ã€å…ƒç´ ç±»å‹ï¼‰ç›¸åŒï¼Œå®ƒä»¬å°±å¯ä»¥ä¸²è”ï¼

```zig
const print = @import("std").debug.print;

pub fn main() void {
    const part_one = [_]i32{ 1, 2, 3, 4 };
    const part_two = [_]i32{ 5, 6, 7, 8 };
    const all_of_it = part_one ++ part_two; // [_]i32{ 1, 2, 3, 4, 5, 6, 7, 8 }

    _ = all_of_it;
}
```

## String

Zig ä¼šå°†å­—ç¬¦ä¸²å‡å®šä¸º UTF-8 ç¼–ç ï¼Œè¿™æ˜¯ç”±äº zig çš„æºæ–‡ä»¶æœ¬èº«å°±æ˜¯ UTF-8 ç¼–ç çš„ï¼Œä»»ä½•çš„é ASCII å­—èŠ‚å‡ä¼šè¢«ä½œä¸º UTF-8 å­—ç¬¦çœ‹å¾…ã€‚ç¼–è¯‘å™¨è¿˜ä¸ä¼šå¯¹å­—èŠ‚è¿›è¡Œä¿®æ”¹ï¼Œå› æ­¤å¦‚æœæƒ³æŠŠé UTF-8 å­—èŠ‚æ”¾å…¥å­—ç¬¦ä¸²ä¸­ï¼Œå¯ä»¥ä½¿ç”¨è½¬ä¹‰ `\xNN`ã€‚

Unicode ç ç‚¹å­—é¢é‡ç±»å‹æ˜¯ `comptime_int`ï¼Œæ‰€æœ‰çš„è½¬ä¹‰å­—ç¬¦å‡å¯ä»¥åœ¨å­—ç¬¦ä¸²å’Œ Unicode ç ç‚¹ä¸­ä½¿ç”¨ã€‚

ä¸ºäº†æ–¹ä¾¿å¤„ç† UTF-8 å’Œ Unicode ï¼Œzig çš„æ ‡å‡†åº“ `std.unicode` ä¸­å®ç°äº†ç›¸å…³çš„å‡½æ•°æ¥å¤„ç†å®ƒä»¬ã€‚

å¯ä»¥å‚ç…§ä»¥ä¸‹ç¤ºä¾‹ï¼š

```zig
const print = @import("std").debug.print;
const mem = @import("std").mem; // ç”¨äºæ¯”è¾ƒå­—èŠ‚

pub fn main() void {
    const bytes = "hello";
    print("{}\n", .{@TypeOf(bytes)}); // *const [5:0]u8
    print("{d}\n", .{bytes.len}); // 5
    print("{c}\n", .{bytes[1]}); // 'e'
    print("{d}\n", .{bytes[5]}); // 0
    print("{}\n", .{'e' == '\x65'}); // true
    print("{d}\n", .{'\u{1f4a9}'}); // 128169
    print("{d}\n", .{'ğŸ’¯'}); // 128175
    print("{u}\n", .{'âš¡'});
    print("{}\n", .{mem.eql(u8, "hello", "h\x65llo")}); // true
    print("{}\n", .{mem.eql(u8, "ğŸ’¯", "\xf0\x9f\x92\xaf")}); // true
    const invalid_utf8 = "\xff\xfe"; // éUTF-8 å­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨\xNN.
    print("0x{x}\n", .{invalid_utf8[1]}); // ç´¢å¼•å®ƒä»¬ä¼šè¿”å›ç‹¬ç«‹çš„å­—èŠ‚
    print("0x{x}\n", .{"ğŸ’¯"[1]});
}
```

### Multiple Lines of String

å¦‚æœè¦ä½¿ç”¨å¤šè¡Œå­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨ `\\`ï¼Œå¤šè¡Œå­—ç¬¦ä¸²æ²¡æœ‰è½¬ä¹‰ï¼Œæœ€åä¸€è¡Œè¡Œå°¾çš„æ¢è¡Œç¬¦å·ä¸ä¼šåŒ…å«åœ¨å­—ç¬¦ä¸²ä¸­ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š

```zig
const print = @import("std").debug.print;

pub fn main() void {
    const hello_world_in_c =
        \\#include <stdio.h>
        \\
        \\int main(int argc, char **argv) {
        \\    printf("hello world\n");
        \\    return 0;
        \\}
    ;
    print("{s}\n", .{hello_world_in_c});
}
```

## Initialize Array

### By Function

å¯ä»¥ä½¿ç”¨å‡½æ•°æ¥åˆå§‹åŒ–æ•°ç»„ï¼Œå‡½æ•°è¦æ±‚è¿”å›ä¸€ä¸ªæ•°ç»„çš„å…ƒç´ æˆ–è€…ä¸€ä¸ªæ•°ç»„ã€‚

```zig
const print = @import("std").debug.print;

pub fn main() void {
    const array = [_]i32{make(3)} ** 10;
    print("{any}\n", .{array});
}

fn make(x: i32) i32 {
    return x + 1;
}
```

### By Compile Time

é€šè¿‡ç¼–è¯‘æœŸæ¥åˆå§‹åŒ–æ•°ç»„ï¼Œä»¥æ­¤æ¥æŠµæ¶ˆè¿è¡Œæ—¶çš„å¼€é”€ï¼

```zig
const print = @import("std").debug.print;

pub fn main() void {
    const fancy_array = init: {
        var initial_value: [10]usize = undefined;
        for (&initial_value, 0..) |*pt, i| {
            pt.* = i;
        }
        break :init initial_value;
    };
    print("{any}\n", .{fancy_array});
}
```

è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ç¼–è¯‘æœŸçš„åŠŸèƒ½ï¼Œæ¥å¸®åŠ©æˆ‘ä»¬å®ç°è¿™ä¸ªæ•°ç»„çš„åˆå§‹åŒ–ï¼ŒåŒæ—¶è¿˜åˆ©ç”¨äº† `blocks` å’Œ `break` çš„æ€§è´¨ã€‚

## Vector

> å‘é‡ï¼ˆVectorï¼‰ä¸ºæˆ‘ä»¬æä¾›äº†å¹¶è¡Œæ“çºµä¸€ç»„åŒç±»å‹ï¼ˆå¸ƒå°”ã€æ•´å‹ã€æµ®ç‚¹ã€æŒ‡é’ˆï¼‰çš„å€¼çš„æ–¹æ³•ï¼Œå®ƒå°½å¯èƒ½ä½¿ç”¨ `SIMD` æŒ‡ä»¤ã€‚

### Basic Use

å‘é‡æ”¯æŒä¸åº•å±‚åŸºæœ¬ç±»å‹ç›¸åŒçš„å†…ç½®è¿ç®—ç¬¦ã€‚è¿™äº›æ“ä½œæ˜¯æŒ‰å…ƒç´ æ‰§è¡Œï¼Œå¹¶è¿”å›ä¸è¾“å…¥å‘é‡é•¿åº¦ç›¸åŒçš„å‘é‡ï¼ŒåŒ…æ‹¬ï¼š

- ç®—æœ¯è¿ç®—ç¬¦ (`+`, `-`, `/`, `*`, `@divFloor`, `@sqrt`, `@ceil`, `@log`, ... )
- ä½æ“ä½œç¬¦ (`>>`, `<<`, `&`, `|`,`~`, ... )
- æ¯”è¾ƒè¿œç®—ç¬¦ (`<`, `>`, `==`, ...)

ç¦æ­¢å¯¹æ ‡é‡ï¼ˆå•ä¸ªæ•°å­—ï¼‰å’Œå‘é‡çš„æ··åˆä½¿ç”¨æ•°å­¦è¿ç®—ç¬¦ï¼ŒZig æä¾›äº† `@splat` å†…å»ºå‡½æ•°æ¥è½»æ¾ä»æ ‡é‡è½¬æ¢ä¸ºå‘é‡ï¼Œå¹¶ä¸”å®ƒæ”¯æŒ `@reduce` å’Œæ•°ç»„ç´¢å¼•è¯­æ³•ä»¥ä»å‘é‡è½¬æ¢ä¸ºæ ‡é‡ï¼Œå‘é‡è¿˜æ”¯æŒå¯¹å…·æœ‰å·²çŸ¥é•¿åº¦çš„å›ºå®šé•¿åº¦æ•°ç»„è¿›è¡Œèµ‹å€¼ï¼Œå¦‚æœéœ€è¦é‡æ–°æ’åˆ—å…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨ `@shuffle` å’Œ `@select` å‡½æ•°ã€‚

{% callout type="note" title="æç¤º" %}
å¯ä»¥ä½¿ç”¨ `@as` å°†å‘é‡è½¬ä¸ºæ•°ç»„ã€‚

æ¯”ç›®æ ‡æœºå™¨çš„ `SIMD`å¤§å°çŸ­çš„å‘é‡çš„æ“ä½œé€šå¸¸ä¼šç¼–è¯‘ä¸ºå•ä¸ª `SIMD` æŒ‡ä»¤ï¼Œè€Œæ¯”ç›®æ ‡æœºå™¨ `SIMD` å¤§å°é•¿çš„å‘é‡å°†ç¼–è¯‘ä¸ºå¤šä¸ª `SIMD` æŒ‡ä»¤ã€‚

å¦‚æœç»™å®šçš„ç›®æ ‡ä½“ç³»æ¶æ„ä¸Šä¸æ”¯æŒ `SIMD`ï¼Œåˆ™ç¼–è¯‘å™¨å°†é»˜è®¤ä¾æ¬¡å¯¹æ¯ä¸ªå‘é‡å…ƒç´ è¿›è¡Œæ“ä½œã€‚

Zig æ”¯æŒä»»ä½•å·²çŸ¥çš„æœ€å¤§ {% inlineMath %} 2^{32}-1 {% /inlineMath %} å‘é‡é•¿åº¦ã€‚è¯·æ³¨æ„ï¼Œè¿‡é•¿çš„å‘é‡é•¿åº¦ï¼ˆä¾‹å¦‚ {% inlineMath %} 2^{20} {% /inlineMath %}ï¼‰å¯èƒ½ä¼šå¯¼è‡´å½“å‰ç‰ˆæœ¬çš„ Zig ä¸Šçš„ç¼–è¯‘å™¨å´©æºƒã€‚
{% /callout %}

### `@splat`

`@splat(scalar: anytype) anytype`

ç”Ÿæˆä¸€ä¸ªå‘é‡ï¼Œå‘é‡çš„æ¯ä¸ªå…ƒç´ å‡æ˜¯ä¼ å…¥çš„å‚æ•° `scalar`ï¼Œå‘é‡çš„ç±»å‹å’Œé•¿åº¦ç”±ç¼–è¯‘å™¨æ¨æ–­ã€‚

```zig
const scalar: u32 = 5;
const result: @Vector(4, u32) = @splat(scalar);
```

### `@reduce`

`@reduce(comptime op: std.builtin.ReduceOp, value: anytype) E`

ä½¿ç”¨ä¼ å…¥çš„è¿ç®—ç¬¦å¯¹å‘é‡è¿›è¡Œæ°´å¹³æŒ‰é¡ºåºåˆå¹¶ï¼ˆ_sequential horizontal reduction_ï¼‰ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªæ ‡é‡ã€‚

```zig
const V = @Vector(4, i32);
const value = V{ 1, -1, 1, -1 };

const result = value > @as(V, @splat(0));
// result æ˜¯ { true, false, true, false };

const is_all_true = @reduce(.And, result);
// is_all_true æ˜¯ false
```

### `@shuffle`

`@shuffle(comptime E: type, a: @Vector(a_len, E), b: @Vector(b_len, E), comptime mask: @Vector(mask_len, i32)) @Vector(mask_len, E)`

æ ¹æ®æ©ç `mask`ï¼ˆä¸€ä¸ªå‘é‡ Vectorï¼‰ï¼Œè¿”å›å‘é‡ `a` æˆ–è€…å‘é‡ `b` çš„å€¼ï¼Œç»„æˆä¸€ä¸ªæ–°çš„å‘é‡ï¼Œ`mask`çš„é•¿åº¦å†³å®šè¿”å›çš„å‘é‡çš„é•¿åº¦ï¼Œå¹¶ä¸”é€ä¸ªæ ¹æ® `mask` ä¸­çš„å€¼ï¼Œæ¥ä» `a` æˆ– `b`é€‰å‡ºå€¼ï¼Œæ­£æ•°æ˜¯ä» `a` é€‰å‡ºæŒ‡å®šç´¢å¼•çš„å€¼ï¼ˆä» `0` å¼€å§‹ï¼Œå˜å¤§ï¼‰ï¼Œè´Ÿæ•°æ˜¯ä» b é€‰å‡ºæŒ‡å®šç´¢å¼•çš„å€¼ï¼ˆä» `-1` å¼€å§‹ï¼Œå˜å°ï¼‰ã€‚

{% callout type="note" title="æç¤º" %}

- å»ºè®®å¯¹ b ä¸­çš„ç´¢å¼•ä½¿ç”¨ `~` è¿ç®—ç¬¦ï¼Œä»¥ä¾¿ä¸¤ä¸ªç´¢å¼•éƒ½å¯ä»¥ä» 0 å¼€å§‹ï¼ˆå³ `~@as(i32, 0)` ä¸º `-1`ï¼‰ã€‚
- å¯¹äºæ¯ä¸ª `mask` æŒ‘é€‰å‡ºæ¥çš„å…ƒç´ ï¼Œå¦‚æœå®ƒä» `A` æˆ– `B` ä¸­çš„é€‰å‡ºçš„å€¼æ˜¯ `undefined`ï¼Œåˆ™ç»“æœå…ƒç´ ä¹Ÿæ˜¯ `undefined`ã€‚
- `mask` ä¸­çš„å…ƒç´ ç´¢å¼•è¶Šç•Œä¼šäº§ç”Ÿç¼–è¯‘é”™è¯¯ã€‚
- å¦‚æœ `a` æˆ– `b` æ˜¯ `undefined`ï¼Œè¯¥å˜é‡é•¿åº¦ç›¸å½“äºå¦ä¸€ä¸ªé `undefined` å˜é‡çš„é•¿åº¦ã€‚å¦‚æœä¸¤ä¸ªå‘é‡å‡æ˜¯ `undefined`ï¼Œåˆ™ `@shuffle` è¿”å›æ‰€æœ‰å…ƒç´ æ˜¯ `undefined` çš„å‘é‡

{% /callout %}

```zig
const a = @Vector(7, u8){ 'o', 'l', 'h', 'e', 'r', 'z', 'w' };
const b = @Vector(4, u8){ 'w', 'd', '!', 'x' };

const mask1 = @Vector(5, i32){ 2, 3, 1, 1, 0 };
const res1: @Vector(5, u8) = @shuffle(u8, a, undefined, mask1);
// resçš„å€¼æ˜¯ hello

// Combining two vectors
const mask2 = @Vector(6, i32){ -1, 0, 4, 1, -2, -3 };
const res2: @Vector(6, u8) = @shuffle(u8, a, b, mask2);
// res2 çš„å€¼æ˜¯ world!
```

### `@select`

`@select(comptime T: type, pred: @Vector(len, bool), a: @Vector(len, T), b: @Vector(len, T)) @Vector(len, T)`

æ ¹æ® `pred`ï¼ˆä¸€ä¸ªå…ƒç´ å…¨ä¸ºå¸ƒå°”ç±»å‹çš„å‘é‡ï¼‰ä» `a` æˆ– `b` ä¸­æŒ‰å…ƒç´ é€‰æ‹©å€¼ã€‚å¦‚æœ `pred[i]` ä¸º `true`ï¼Œåˆ™ç»“æœä¸­çš„ç›¸åº”å…ƒç´ å°†ä¸º `a[i]`ï¼Œå¦åˆ™ä¸º `b[i]`ã€‚

```zig
const ele_4 = @Vector(4, i32);

// å‘é‡å¿…é¡»æ‹¥æœ‰ç¼–è¯‘æœŸå·²çŸ¥çš„é•¿åº¦å’Œç±»å‹
const a = ele_4{ 1, 2, 3, 4 };
const b = ele_4{ 5, 6, 7, 8 };

const pred = @Vector(4, bool){
    true,
    false,
    false,
    true,
};

const c = @select(i32, pred, a, b);
// c æ˜¯ { 1, 6, 7, 4 }
```

## Pointer

> zig ä½œä¸ºä¸€é—¨ low level è¯­è¨€ï¼Œé‚£è‚¯å®šè¦æœ‰æŒ‡é’ˆçš„ã€‚

æŒ‡é’ˆæ˜¯æŒ‡å‘ä¸€å—å†…å­˜åŒºåŸŸåœ°å€çš„å˜é‡ï¼Œå®ƒå­˜å‚¨äº†ä¸€ä¸ªåœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‡é’ˆæ¥æ“ä½œå…¶æŒ‡å‘å†…å­˜åŒºåŸŸã€‚

å–åœ°å€ï¼šé€šè¿‡ & ç¬¦å·æ¥è·å–æŸä¸ªå˜é‡æ‰€å¯¹åº”çš„å†…å­˜åœ°å€ï¼Œå¦‚ &integer å°±æ˜¯è·å–å˜é‡ integer çš„å†…å­˜åœ°å€ã€‚

Zig çš„æŒ‡é’ˆå’Œ C çš„æŒ‡é’ˆç•¥æœ‰ä¸åŒï¼ŒåŒ…å«ä¸¤ç§æŒ‡é’ˆï¼Œä¸€ç§å•é¡¹ï¼ˆ_single-item_ï¼‰æŒ‡é’ˆï¼Œä¸€ç§æ˜¯å¤šé¡¹ï¼ˆ_many-item_ï¼‰æŒ‡é’ˆï¼Œå®ƒä»¬çš„è§£å¼•ç”¨çš„æ–¹å¼ä¹Ÿç•¥æœ‰ä¸åŒã€‚

{% callout type="note" title="æŒ‡é’ˆè¿ç®—" %}

Zig æœ¬èº«æ”¯æŒæŒ‡é’ˆè¿ç®—ï¼ˆåŠ å‡æ“ä½œï¼‰ï¼Œä½†æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼šæœ€å¥½å°†æŒ‡é’ˆåˆ†é…ç»™ `[*]T` ç±»å‹åå†è¿›è¡Œè®¡ç®—ã€‚

å°¤å…¶æ˜¯åœ¨åˆ‡ç‰‡ä¸­ï¼Œä¸å¯ç›´æ¥å¯¹å…¶æŒ‡é’ˆè¿›è¡Œæ›´æ”¹ï¼Œè¿™ä¼šç ´ååˆ‡ç‰‡çš„å†…éƒ¨ç»“æ„ï¼
{% /callout %}

### Single Pointer

å•é¡¹æŒ‡é’ˆæŒ‡å‘å•ä¸ªå…ƒç´ ã€‚

å•é¡¹æŒ‡é’ˆçš„ç±»å‹ä¸ºï¼š`*T`ï¼Œ`T`æ˜¯æ‰€æŒ‡å‘å†…å­˜åŒºåŸŸçš„ç±»å‹ï¼Œè§£å¼•ç”¨æ–¹æ³•æ˜¯ `ptr.*`ã€‚

```zig
const print = @import("std").debug.print;

pub fn main() !void {
    var integer: i16 = 666;
    const ptr = &integer;
    ptr.* = ptr.* + 1;

    print("{}\n", .{integer}); // 667
}
```

### Multiple Pointers

å¤šé¡¹æŒ‡é’ˆæŒ‡å‘ä½ç½®æ•°é‡çš„å¤šä¸ªå…ƒç´ ã€‚

å¤šé¡¹æŒ‡é’ˆçš„ç±»å‹ä¸ºï¼š`[*]T`ï¼Œ`T`æ˜¯æ‰€æŒ‡å‘å†…å­˜åŒºåŸŸçš„ç±»å‹ï¼Œä¸”è¯¥ç±»å‹å¿…é¡»å…·æœ‰æ˜ç¡®çš„å¤§å°ï¼ˆè¿™æ„å‘³ç€å®ƒä¸èƒ½æ˜¯ anyopaque å’Œå…¶ä»–ä»»æ„ä¸é€æ˜ç±»å‹ï¼‰ã€‚

è§£å¼•ç”¨æ–¹æ³•æ”¯æŒä»¥ä¸‹å‡ ç§ï¼š

- ç´¢å¼•è¯­æ³• `ptr[i]`
- åˆ‡ç‰‡è¯­æ³• `ptr[start..end]`
- æŒ‡é’ˆè¿ç®— `ptr + x`ï¼Œ`ptr - x`

```zig
const print = @import("std").debug.print;

pub fn main() !void {
    const array = [_]i32{ 1, 2, 3, 4 };
    const ptr: [*]const i32 = &array;

    print("ç¬¬ä¸€ä¸ªå…ƒç´ ï¼š{}\n", .{ptr[0]});
}
```

{% callout type="note" title="æç¤º" %}
å¯¹äºæ•°ç»„å’Œåˆ‡ç‰‡ï¼Œå®ƒä»¬ä¹Ÿæœ‰å¯¹åº”çš„æŒ‡é’ˆç±»å‹ã€‚

æ•°ç»„ï¼š`*[N]T`ï¼Œ`N`æ˜¯æ•°ç»„çš„é•¿åº¦ï¼Œå®ƒç›¸å½“äºä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„å•é¡¹æŒ‡é’ˆã€‚

åˆ‡ç‰‡ï¼š`[]T`ï¼Œå®ƒç›¸å½“äºä¸€ä¸ªèƒ–æŒ‡é’ˆï¼ŒåŒ…å«äº†ä¸€ä¸ª æŒ‡é’ˆç±»å‹ `[*]T` å’Œ é•¿åº¦ã€‚

æ•°ç»„å’Œåˆ‡ç‰‡çš„æŒ‡é’ˆéƒ½å­˜å‚¨äº†é•¿åº¦ï¼Œå› æ­¤å®ƒä»¬é™¤äº†æŒ‡é’ˆé»˜è®¤çš„è¯­æ³•å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„è¯­æ³• `ptr.len`ï¼Œç”¨æ¥è·å–å®ƒä»¬çš„é•¿åº¦ã€‚

```zig
const print = @import("std").debug.print;

pub fn main() !void {
    const array = [_]i32{ 1, 2, 3, 4 };
    const ptr: [*]const i32 = &array;

    print("ç¬¬ä¸€ä¸ªå…ƒç´ ï¼š{}\n", .{ptr[0]});
}
```

{% /callout %}

#### Sentinel Pointer

å“¨å…µæŒ‡é’ˆå°±å’Œå“¨å…µæ•°ç»„ç±»ä¼¼ï¼Œæˆ‘ä»¬ä½¿ç”¨è¯­æ³• `[*:x]T`ï¼Œè¿™ä¸ªæŒ‡é’ˆæ ‡è®°äº†è¾¹ç•Œçš„å€¼ï¼Œæ•…ç§°ä¸ºâ€œå“¨å…µâ€ã€‚

å®ƒçš„é•¿åº¦æœ‰æ ‡è®°å€¼ `x` æ¥ç¡®å®šï¼Œè¿™æ ·åšçš„å¥½å¤„å°±æ˜¯æä¾›äº†é’ˆå¯¹ç¼“å†²åŒºæº¢å‡ºå’Œè¿‡åº¦è¯»å–çš„ä¿æŠ¤ã€‚

{% callout type="book" title="ä¾‹å­" %}
æˆ‘ä»¬æ¥ä¸‹æ¥æ¼”ç¤ºä¸€ä¸ªç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹ä¸­ä½¿ç”¨äº† zig å¯ä»¥æ— ç¼ä¸ C äº¤äº’çš„ç‰¹æ€§ï¼Œæ•…ä½ å¯ä»¥æš‚æ—¶ç•¥è¿‡è¿™é‡Œï¼

```zig
const std = @import("std");

// æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ std.c.printf ä»£æ›¿
pub extern "c" fn printf(format: [*:0]const u8, ...) c_int;

pub fn main() anyerror!void {
    _ = printf("Hello, world!\n"); // OK
}
```

ä»¥ä¸Šä»£ç ç¼–è¯‘éœ€è¦é¢å¤–è¿æ¥ `libc` ï¼Œä½ åªéœ€è¦åœ¨ä½ çš„ `build.zig` ä¸­æ·»åŠ  `exe.linkLibC();` å³å¯ã€‚
{% /callout %}

### Difference between Multiple Pointers and Single Pointer

æœ¬éƒ¨åˆ†ä¸“é—¨ç”¨äºè§£é‡Šå¹¶åŒºåˆ«å•å‘æŒ‡é’ˆå’Œå¤šé¡¹æŒ‡é’ˆï¼

å…ˆåˆ—å‡ºä»¥ä¸‹ç±»å‹ï¼š

{% table %}

- ç±»å‹
- è§£é‡Š

---

- `[4] const u8`
- è¯¥ç±»å‹ä»£è¡¨çš„æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º `4` çš„æ•°ç»„ï¼Œæ•°ç»„å†…çš„å…ƒç´ ç±»å‹ä¸º `const u8`

---

- `[] const u8`
- è¯¥ç±»å‹ä»£è¡¨çš„æ˜¯ä¸€ä¸ªåˆ‡ç‰‡ï¼Œåˆ‡ç‰‡å†…å…ƒç´ ç±»å‹ä¸º `const u8`

---

- `*[4] const u8`
- è¯¥ç±»å‹ä»£è¡¨çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œå†…å­˜ä¸­è¯¥åœ°å€å­˜å‚¨ç€ä¸€ä¸ªé•¿åº¦ä¸º `4` çš„æ•°ç»„ï¼Œæ•°ç»„å†…çš„å…ƒç´ ç±»å‹ä¸º `const u8`

---

- `*[] const u8`
- è¯¥ç±»å‹ä»£è¡¨çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œå†…å­˜ä¸­è¯¥åœ°å€å­˜å‚¨ç€ä¸€ä¸ªåˆ‡ç‰‡

---

- `[*] const u8`
- è¯¥ç±»å‹ä»£è¡¨çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œå†…å­˜ä¸­è¯¥åœ°å€å­˜å‚¨ç€ä¸€ä¸ªæ•°ç»„ï¼Œä½†é•¿åº¦æœªçŸ¥ï¼

{% /table %}

å…¶ä¸­ `[*] const u8` å¯ä»¥çœ‹ä½œæ˜¯ C ä¸­çš„ `* const char`ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ C è¯­è¨€ä¸­ä¸€ä¸ªæ™®é€šçš„æŒ‡é’ˆä¹Ÿå¯ä»¥æŒ‡å‘ä¸€ä¸ªæ•°ç»„ï¼Œzig ä»…ä»…æ˜¯å•ç‹¬æŠŠè¿™ç§ä»¤äººè¿·æƒ‘çš„è¡Œä¸ºå•ç‹¬ä½œä¸ºä¸€ä¸ªè¯­æ³•è€Œå·²ï¼

### Extra Pointer Features

#### volatile

å¯¹æŒ‡é’ˆçš„æ“ä½œåº”å‡å®šä¸ºæ²¡æœ‰å‰¯ä½œç”¨ã€‚å¦‚æœå­˜åœ¨å‰¯ä½œç”¨ï¼Œä¾‹å¦‚ä½¿ç”¨å†…å­˜æ˜ å°„è¾“å…¥è¾“å‡ºï¼ˆ_Memory Mapped Input/Output_ï¼‰ï¼Œåˆ™éœ€è¦ä½¿ç”¨ `volatile` å…³é”®å­—æ¥ä¿®é¥°ã€‚

åœ¨ä»¥ä¸‹ä»£ç ä¸­ï¼Œä¿è¯ä½¿ç”¨ `mmio_ptr` çš„å€¼è¿›è¡Œæ“ä½œï¼ˆè¿™é‡Œä½ çœ‹èµ·æ¥å¯èƒ½ä¼šæ„Ÿåˆ°è¿·æƒ‘ï¼Œåœ¨ç¼–è¯‘ä»£ç æ—¶ï¼Œç¼–è¯‘å™¨å¯ä»¥èƒ½ä¼šè®©å€¼åœ¨å®é™…è¿è¡Œè¿‡ç¨‹ä¸­è¿›è¡Œç¼“å­˜ï¼Œè¿™é‡Œä¿è¯æ¯æ¬¡éƒ½ä½¿ç”¨ `mmio_ptr` çš„å€¼ï¼Œä»¥é¿å…æ— æ³•æ­£ç¡®è§¦å‘ â€œå‰¯ä½œç”¨â€ï¼‰ï¼Œå¹¶ä¿è¯äº†ä»£ç æ‰§è¡Œçš„é¡ºåºã€‚

```zig
// expect æ˜¯å•å…ƒæµ‹è¯•çš„æ–­è¨€å‡½æ•°
const expect = @import("std").testing.expect;

pub fn main() !void {
    const mmio_ptr: *volatile u8 = @ptrFromInt(0x12345678);
    try expect(@TypeOf(mmio_ptr) == *volatile u8);
}
```

#### Memory Alignment

æ¯ç§ç±»å‹éƒ½æœ‰ä¸€ä¸ªå¯¹é½æ–¹å¼â€”â€”æ•°ä¸ªå­—èŠ‚ï¼Œè¿™æ ·ï¼Œå½“ä»å†…å­˜åŠ è½½æˆ–å­˜å‚¨è¯¥ç±»å‹çš„å€¼æ—¶ï¼Œå†…å­˜åœ°å€å¿…é¡»èƒ½è¢«è¯¥æ•°å­—æ•´é™¤ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `@alignOf` æ‰¾å‡ºä»»ä½•ç±»å‹çš„å†…å­˜å¯¹é½å¤§å°ã€‚

å†…å­˜å¯¹é½å¤§å°å–å†³äº CPU æ¶æ„ï¼Œä½†å§‹ç»ˆæ˜¯ `2` çš„å¹‚ï¼Œå¹¶ä¸”å°äº `1 << 29`ã€‚

åœ¨ Zig ä¸­ï¼ŒæŒ‡é’ˆç±»å‹å…·æœ‰å¯¹é½å€¼ã€‚å¦‚æœè¯¥å€¼ç­‰äºåŸºç¡€ç±»å‹çš„å¯¹é½æ–¹å¼ï¼Œåˆ™å¯ä»¥ä»ç±»å‹ä¸­çœç•¥å®ƒï¼š

```zig
const std = @import("std");
const builtin = @import("builtin");
const expect = std.testing.expect;

pub fn main() !void {
    var x: i32 = 1234;
    // è·å–å†…å­˜å¯¹é½ä¿¡æ¯
    const align_of_i32 = @alignOf(@TypeOf(x));
    // å°è¯•æ¯”è¾ƒç±»å‹
    try expect(@TypeOf(&x) == *i32);
    // å°è¯•åœ¨è®¾ç½®å†…å­˜å¯¹é½åå†è¿›è¡Œç±»å‹æ¯”è¾ƒ
    try expect(*i32 == *align(align_of_i32) i32);

    if (builtin.target.cpu.arch == .x86_64) {
        // è·å–äº† x86_64 æ¶æ„çš„æŒ‡é’ˆå¯¹é½å¤§å°
        try expect(@typeInfo(*i32).Pointer.alignment == 4);
    }
}
```

{% callout type="note" title="æç¤º" %}
å’Œ `*i32` ç±»å‹å¯ä»¥å¼ºåˆ¶è½¬æ¢ä¸º `*const i32` ç±»å‹ç±»ä¼¼ï¼Œå…·æœ‰è¾ƒå¤§å¯¹é½å¤§å°çš„æŒ‡é’ˆå¯ä»¥éšå¼è½¬æ¢ä¸ºå…·æœ‰è¾ƒå°å¯¹é½å¤§å°çš„æŒ‡é’ˆï¼Œä½†åä¹‹åˆ™ä¸ç„¶ã€‚

å¦‚æœæœ‰ä¸€ä¸ªæŒ‡é’ˆæˆ–åˆ‡ç‰‡çš„å¯¹é½æ–¹å¼è¾ƒå°ï¼Œä½†çŸ¥é“å®ƒå®é™…ä¸Šå…·æœ‰è¾ƒå¤§çš„å¯¹é½æ–¹å¼ï¼Œè¯·ä½¿ç”¨ `@alignCast` å°†æŒ‡é’ˆæ›´æ”¹ä¸ºæ›´å¯¹é½çš„æŒ‡é’ˆï¼Œä¾‹å¦‚ï¼š`@as([]align(4) u8, @alignCast(slice4))`ï¼Œè¿™åœ¨è¿è¡Œæ—¶æ— æ“ä½œï¼Œä½†æ’å…¥äº†å®‰å…¨æ£€æŸ¥ã€‚

```zig
const expect = @import("std").testing.expect;

// å…¨å±€å˜é‡
var foo: u8 align(4) = 100;

fn derp() align(@sizeOf(usize) * 2) i32 {
    return 1234;
}

// ä»¥ä¸‹æ˜¯ä¸¤ä¸ªå‡½æ•°
fn noop1() align(1) void {}
fn noop4() align(4) void {}

pub fn main() !void {
    // å…¨å±€å˜é‡å¯¹é½
    try expect(@typeInfo(@TypeOf(&foo)).Pointer.alignment == 4);
    try expect(@TypeOf(&foo) == *align(4) u8);
    const as_pointer_to_array: *align(4) [1]u8 = &foo;
    const as_slice: []align(4) u8 = as_pointer_to_array;
    const as_unaligned_slice: []u8 = as_slice;
    try expect(as_unaligned_slice[0] == 100);

    // å‡½æ•°å¯¹é½
    try expect(derp() == 1234);
    try expect(@TypeOf(derp) == fn () i32);
    try expect(@TypeOf(&derp) == *align(@sizeOf(usize) * 2) const fn () i32);

    noop1();
    try expect(@TypeOf(noop1) == fn () void);
    try expect(@TypeOf(&noop1) == *align(1) const fn () void);

    noop4();
    try expect(@TypeOf(noop4) == fn () void);
    try expect(@TypeOf(&noop4) == *align(4) const fn () void);
}
```

{% /callout %}

#### Zero Pointer

é›¶æŒ‡é’ˆå®é™…ä¸Šæ˜¯ä¸€ä¸ªæœªå®šä¹‰çš„é”™è¯¯è¡Œä¸ºï¼ˆ_Pointer Cast Invalid Null_ï¼‰ï¼Œä½†æ˜¯å½“æˆ‘ä»¬ç»™æŒ‡é’ˆå¢åŠ ä¸Š `allowzero` ä¿®é¥°ç¬¦åï¼Œå®ƒå°±å˜æˆåˆæ³•çš„è¡Œä¸ºäº†ï¼

{% callout type="note" title="é›¶æŒ‡é’ˆçš„ä½¿ç”¨" %}

è¯·åªåœ¨ç›®æ ‡ OS ä¸º `freestanding` æ—¶ä½¿ç”¨é›¶æŒ‡é’ˆï¼Œå¦‚æœæƒ³è¡¨ç¤º `null` æŒ‡é’ˆï¼Œè¯·ä½¿ç”¨å¯é€‰ç±»å‹ï¼

{% /callout %}

```zig
// æœ¬ç¤ºä¾‹ä¸­ä»…ä»…æ˜¯æ„å»ºäº†ä¸€ä¸ªé›¶æŒ‡é’ˆ
// å¹¶æœªä½¿ç”¨ï¼Œæ•…å¯ä»¥åœ¨æ‰€æœ‰å¹³å°è¿è¡Œ
const std = @import("std");
const expect = std.testing.expect;

pub fn main() !void {
    const zero: usize = 0;
    const ptr: *allowzero i32 = @ptrFromInt(zero);
    try expect(@intFromPtr(ptr) == 0);
}
```

#### Compile Time

åªè¦ä»£ç ä¸ä¾èµ–äºæœªå®šä¹‰çš„å†…å­˜å¸ƒå±€ï¼Œé‚£ä¹ˆæŒ‡é’ˆä¹Ÿå¯ä»¥åœ¨ç¼–è¯‘æœŸå‘æŒ¥ä½œç”¨ï¼

```zig
const expect = @import("std").testing.expect;

pub fn main() void {
    comptime {
        // åœ¨è¿™ä¸ª comptime å—ä¸­ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨pointer
        // ä¸ä¾èµ–äºç¼–è¯‘ç»“æœçš„å†…å­˜å¸ƒå±€ï¼Œå³åœ¨ç¼–è¯‘æœŸæ—¶ä¸ä¾èµ–äºæœªå®šä¹‰çš„å†…å­˜å¸ƒå±€
        var x: i32 = 1;
        const ptr = &x;
        ptr.* += 1;
        x += 1;
        try expect(ptr.* == 3);
    }
}
```

## Slices

åˆ‡ç‰‡å’Œæ•°ç»„çœ‹èµ·æ¥ä¸Šå¾ˆåƒï¼Œåœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œä½ å¯èƒ½ä¼šæƒ³è¦ä½¿ç”¨åˆ‡ç‰‡ï¼Œå› ä¸ºå®ƒç›¸å¯¹æ•°ç»„æ¥è¯´ï¼Œè¦æ›´åŠ çµæ´»ï¼

ä½ å¯ä»¥å¯¹æ•°ç»„ã€åˆ‡ç‰‡ã€æ•°ç»„æŒ‡é’ˆè¿›è¡Œåˆ‡ç‰‡æ“ä½œï¼

æ¥ä¸‹æ¥æˆ‘ä»¬æ¼”ç¤ºåˆ‡ç‰‡çš„ä½¿ç”¨æ–¹å¼ï¼š

```zig
var array = [_]i32{ 1, 2, 3, 4 };

const len: usize = 3;
const slice: []i32 = array[0..len];

for (slice, 0..) |ele, index| {
    print("ç¬¬{}ä¸ªå…ƒç´ ä¸ºï¼š{}\n", .{ index + 1, ele });
}
print("slice ç±»å‹ä¸º{}\n", .{@TypeOf(slice)});

const slice_2: []i32 = array[0..array.len];
print("slice_2 ç±»å‹ä¸º{}\n", .{@TypeOf(slice_2)});
```

æ‰“å°ç»“æœï¼š

```text
ç¬¬1ä¸ªå…ƒç´ ä¸ºï¼š1
ç¬¬2ä¸ªå…ƒç´ ä¸ºï¼š2
ç¬¬3ä¸ªå…ƒç´ ä¸ºï¼š3
slice ç±»å‹ä¸º[]i32
slice_2 ç±»å‹ä¸º[]i32
```

åˆ‡ç‰‡çš„ä½¿ç”¨æ–¹å¼å°±æ˜¯ç±»ä¼¼æ•°ç»„ï¼Œä¸è¿‡`[]`ä¸­çš„æ˜¯ç´¢å¼•çš„è¾¹ç•Œå€¼ï¼Œéµå¾ªâ€œå·¦é—­å³å¼€â€è§„åˆ™ã€‚

ä»¥ä¸Šæˆ‘ä»¬å¯¹æ•°ç»„å–åˆ‡ç‰‡ï¼Œå·¦è¾¹ç•Œå€¼ä¸º`0`,å³è¾¹ç•Œå€¼ä¸º `len` å˜é‡ã€‚

æ³¨æ„ï¼Œè¿™é‡Œè¯´çš„æ˜¯è¾¹ç•Œå€¼æœ‰ä¸€ä¸ªæ˜¯å˜é‡ï¼ˆè¿è¡Œæ—¶å¯çŸ¥ï¼‰ï¼Œå¦‚æœä¸¤ä¸ªè¾¹ç•Œå€¼å‡æ˜¯ç¼–è¯‘æœŸå¯çŸ¥çš„è¯ï¼Œç¼–è¯‘å™¨ä¼šç›´æ¥å°†åˆ‡ç‰‡ä¼˜åŒ–ä¸ºæ•°ç»„æŒ‡é’ˆã€‚

{% callout type="note" title="åˆ‡ç‰‡çš„æœ¬è´¨" %}
å®ƒæœ¬è´¨æ˜¯ä¸€ä¸ªèƒ–æŒ‡é’ˆï¼ŒåŒ…å«äº†ä¸€ä¸ª æŒ‡é’ˆç±»å‹ `[*]T` å’Œ é•¿åº¦ã€‚

åŒæ—¶ï¼Œå®ƒçš„æŒ‡é’ˆ `slice.ptr` å’Œé•¿åº¦ `slice.len` å‡æ˜¯å¯ä»¥æ“ä½œçš„ï¼Œä½†åœ¨å®è·µä¸­ï¼Œè¯·ä¸è¦æ“ä½œå®ƒä»¬ï¼Œè¿™å®¹æ˜“ç ´ååˆ‡ç‰‡çš„å†…éƒ¨ç»“æ„ï¼ˆé™¤éä½ æœ‰æŠŠæ¡æ¯æ¬¡éƒ½èƒ½æ­£ç¡®çš„å¤„ç†å®ƒä»¬ï¼‰ã€‚
{% /callout %}

### Slices Pointer

åˆ‡ç‰‡æœ¬èº«é™¤äº†å…·æœ‰ `len` å±æ€§å¤–ï¼Œè¿˜å…·æœ‰ `ptr` å±æ€§ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡è¯­æ³• `slice.ptr` æ¥æ“ä½œåˆ‡ç‰‡çš„æŒ‡é’ˆï¼Œå®ƒæ˜¯ä¸€ä¸ªå¤šé¡¹æŒ‡é’ˆï¼

å½“æˆ‘ä»¬å¯¹åˆ‡ç‰‡å…ƒç´ å–åœ°å€ï¼ˆ`&`ï¼‰æ—¶ï¼Œå¾—åˆ°çš„æ˜¯å•é¡¹æŒ‡é’ˆã€‚

åŒæ—¶ï¼Œåˆ‡ç‰‡æœ¬èº«è¿˜æœ‰è¾¹ç•Œæ£€æŸ¥ï¼Œä½†æ˜¯å¯¹åˆ‡ç‰‡æŒ‡é’ˆåšæ“ä½œåˆ™ä¸ä¼šæœ‰è¾¹ç•Œæ£€æŸ¥ï¼

```zig
var array = [_]i32{ 1, 2, 3, 4 };

// è¾¹ç•Œä½¿ç”¨å˜é‡ï¼Œä¿è¯åˆ‡ç‰‡ä¸ä¼šè¢«ä¼˜åŒ–ä¸ºæ•°ç»„æŒ‡é’ˆ
const len: usize = 3;

var slice: []i32 = array[0..len];

print("slice.ptr ç±»å‹ä¸º{}\n", .{@TypeOf(slice.ptr)});
print("slice çš„ç´¢å¼• 0 å–åœ°å€ï¼Œå¾—åˆ°æŒ‡é’ˆç±»å‹ä¸º{}\n", .{@TypeOf(&slice[0])});
```

æ‰“å°ç»“æœå¦‚ä¸‹ï¼š

```text
slice.ptr ç±»å‹ä¸º[*]i32
slice çš„ç´¢å¼• 0 å–åœ°å€ï¼Œå¾—åˆ°æŒ‡é’ˆç±»å‹ä¸º*i32
```

### Sentinel Slices

è¯­æ³• `[:x]T` æ˜¯ä¸€ä¸ªåˆ‡ç‰‡ï¼Œå®ƒå…·æœ‰è¿è¡Œæ—¶å·²çŸ¥çš„é•¿åº¦ï¼Œå¹¶ä¸”è¿˜ä¿è¯ç”±è¯¥é•¿åº¦ç´¢å¼•çš„å…ƒç´ çš„æ ‡è®°å€¼ã€‚è¯¥ç±»å‹ä¸ä¿è¯åœ¨æ­¤ä¹‹å‰ä¸å­˜åœ¨å“¨å…µå…ƒç´ ï¼Œå“¨å…µç»ˆæ­¢çš„åˆ‡ç‰‡å…è®¸å…ƒç´ è®¿é—® `len` ç´¢å¼•ã€‚

å“¨å…µåˆ‡ç‰‡ä¹Ÿå¯ä»¥ä½¿ç”¨åˆ‡ç‰‡è¯­æ³• `data[start..end :x]` çš„å˜ä½“æ¥åˆ›å»ºï¼Œå…¶ä¸­ `data` æ˜¯å¤šé¡¹æŒ‡é’ˆã€æ•°ç»„æˆ–åˆ‡ç‰‡ï¼Œ`x` æ˜¯å“¨å…µå€¼ã€‚

å“¨å…µåˆ‡ç‰‡è®¤å®šå“¨å…µä½ç½®å¤„çš„å…ƒç´ æ˜¯å“¨å…µå€¼ï¼Œå¦‚æœä¸æ˜¯è¿™ç§æƒ…å†µï¼Œåˆ™ä¼šè§¦å‘å®‰å…¨ä¿æŠ¤ä¸­çš„æœªå®šä¹‰é—®é¢˜ã€‚

```zig
// æ˜¾å¼å£°æ˜åˆ‡ç‰‡ç±»å‹
const str_slice: [:0]const u8 = "hello";
print("str_sliceç±»å‹ï¼š{}\n", .{@TypeOf(str_slice)});

var array = [_]u8{ 3, 2, 1, 0, 3, 2, 1, 0 };
const runtime_length: usize = 3;
const slice: [:0]u8 = array[0..runtime_length :0];
print("sliceç±»å‹ï¼š{}\n", .{@TypeOf(slice)});
```

æ‰“å°ç»“æœï¼š

```text
str_sliceç±»å‹ï¼š[:0]const u8
sliceç±»å‹ï¼š[:0]u8
```

## Structure

> ç»“æ„ä½“æœ¬èº«æ˜¯ä¸€ä¸ªé«˜çº§çš„æ•°æ®ç»“æ„ï¼Œç”¨äºå°†å¤šä¸ªæ•°æ®è¡¨ç¤ºä¸ºä¸€ä¸ªæ•´ä½“ã€‚

### Basic Use

ç»“æ„ä½“çš„ç»„æˆï¼š

- é¦–éƒ¨å…³é”®å­— `struct`
- å’Œå˜é‡å®šä¹‰ä¸€æ ·çš„ç»“æ„ä½“åå­—
- å¤šä¸ªå­—æ®µ
- æ–¹æ³•
- å¤šä¸ªå£°æ˜

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€çŸ­çš„ç»“æ„ä½“å£°æ˜ï¼š

```zig
const Circle = struct {
    radius: u8,

    const PI: f16 = 3.14;

    pub fn init(radius: u8) Circle {
        return Circle{ .radius = radius };
    }

    fn area(self: *Circle) f16 {
        return @as(f16, @floatFromInt(self.radius * self.radius)) * PI;
    }
};
```

ä¸Šæ–¹çš„ä»£ç çš„å†…å®¹ï¼š

- å®šä¹‰äº†ä¸€ä¸ªç»“æ„ä½“ `Circle`ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªåœ†
- åŒ…å«å­—æ®µ `radius`
- ä¸€ä¸ªå£°æ˜ `PI`
- åŒ…å«ä¸¤ä¸ªæ–¹æ³• `init` å’Œ `area`

{% callout type="note" title="æç¤º" %}
å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç»“æ„ä½“çš„æ–¹æ³•é™¤äº†ä½¿ç”¨ `.` è¯­æ³•æ¥ä½¿ç”¨å¤–ï¼Œå’Œå…¶ä»–çš„å‡½æ•°æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼è¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨ä»»ä½•ä½ ç”¨æ™®é€šå‡½æ•°çš„åœ°æ–¹ä½¿ç”¨ç»“æ„ä½“çš„æ–¹æ³•ã€‚
{% /callout %}

### Self-reference

å¸¸è§çš„è‡ªå¼•ç”¨æ–¹å¼æ˜¯å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç»“æ„ä½“æŒ‡é’ˆç±»å‹ï¼Œä¾‹å¦‚ï¼š

```zig
const TT = struct {
    pub fn print(self: *TT) void {
        _ = self; // _ è¡¨ç¤ºä¸ä½¿ç”¨å˜é‡
        std.debug.print("Hello, world!\n", .{});
    }
};
```

{% /article %}

{% article i18n="en" %}

# Data Structure

{% /article %}
